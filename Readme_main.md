# main.py の解説資料

## 用語

| 用語               | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ライブラリ         | ライブラリは、**便利な道具がたくさん入った道具箱**のようなものです。</br> プログラミングでは、複雑な処理を自分で一から作るのは大変です。そこで、誰かが作ってくれた便利な機能（道具）をまとめたものが「ライブラリ」として用意されています。私たちはそれを「**import**（インポート）」という命令で自分のプログラムに読み込むだけで、すぐに使うことができます。                                                                                                                                                                                                                                                                                                                                                  |
| 関数               | 関数は、**特定の仕事をしてくれる、小さなプログラムのかたまり**です。</br> 何かをお願い（データを渡す）すると、決まった処理を実行して、その結果を返してくれます。同じ作業を何度も繰り返す場合に、その作業を一つの関数としてまとめておくと、プログラムがとてもスッキリして分かりやすくなります。                                                                                                                                                                                                                                                                                                                                                                                                                |
| ターミナル         | ターミナルは、**コンピュータと直接文字で対話するための命令画面**です。</br>普段はマウスでアイコンをクリックしてコンピュータを操作しますが、ターミナルではキーボードから命令（コマンド）を打ち込むことで、より直接的にコンピュータに指示を出せます。</br>**黒い画面で文字だけが表示される**ことが多いです。</br>例えば、ターミナルで`(python main.py`を入力して「Enter」キーを押すとPythonプログラム`main.py`を実行します。                                                                                                                                                                                                                                                                                    |
| フォルダ           | フォルダは、**ファイルを整理整頓するための「キャビネットの引き出し」**のようなものです。</br>パソコンの中にはたくさんのファイルがあります。それらがバラバラに置かれていると、どこに何があるのか分からなくなってしまいます。そこで、関係のあるファイル同士を一つの「フォルダ」に入れて管理します。 </br>プログラムのコード、使う画像、集めたデータなどを別々のフォルダに分けることで、全体がスッキリします。</br>フォルダの中に、さらに別のフォルダを作ることもできます。「書類キャビネット」→「プロジェクトごとの引き出し」→「日付ごとの仕切り」のように、細かく分類できます。                                                                                                                                |
| ファイルのパス     | ファイルのパスは、**コンピュータの中にあるファイルの「住所」**です。</br>フォルダの階層構造を使って「どのキャビネットの、どの引き出しにあるファイルか」を示しています。</br>パソコンの中にはたくさんのフォルダやファイルがあります。その中から目的のファイルがどこにあるのかを正確に示すための文字列が「パス」です。                                                                                                                                                                                                                                                                                                                                                                                          |
| ファイルの絶対パス | 「東京都千代田区…」のように、一番上の階層から目的地までの全ての道のりを書いた「住所」です。誰が見ても同じ場所を指します。</br> 例： `C:\Users\Taro\Documents\obj-detect\sample.py`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ファイルの相対パス | 「今いる場所から見て、あそこの角を右に曲がったところ」のように、現在地からの位置関係で示す「住所」です。</br> 例： `./sample000.jpg`: 今いるフォルダの中にある`sample000.jpg`ファイル</br> ../test_data/sandwich_1.jpg: 今いるフォルダにある`test_data`フォルダの中の`sandwich_1.jpg`ファイル                                                                                                                                                                                                                                                                                                                                                                                                                 |
| AIモデル           | **たくさんのデータで訓練された「賢い脳みそ」や、特定の仕事をする専門家**のようなものです。</br>人間の脳が、たくさんの経験を通して物事を学んでいくように、AIモデルも膨大な量のデータ（文章、画像、数値など）を学習することで、特定のパターンやルールを見つけ出します。</br>学習が終わったAIモデルは、その知識を使って、未知のデータに対する予測や判断ができるようになります。</br>例えば、このプログラムの中で使用しているYOLOモデルは画像から写している物体を検出する専門家のような物です。</br>Pythonでは、こうしたAIモデルを作ったり、すでに作られたAIモデルを呼び出して使ったりするための**ライブラリ/道具箱**が非常に充実しています。そのため、PythonはAI開発の分野で広く使われています。 |

## プログラム全体の流れ

このプログラムは、画像に写っている物体を自動で見つけてくれる「物体検出」のデモです。主に次のような流れで動きます。

1. 必要なライブラリ（YOLO, OpenCV, NumPy, Matplotlib）を読み込みます。
2. YOLOというAIモデルを使って、物体検出用のモデルファイルを読み込みます。
3. 検出したい画像ファイルを指定します。
4. 画像の中にある物体をYOLOモデルで検出します。
5. 検出結果を画像に描き込み、ターミナルにも結果を表示します。
6. 最後に、検出結果を保存した画像（output.jpg）を作成します。

このように、プログラムは「モデルの準備」→「画像の指定」→「物体検出」→「結果の表示・保存」という順番で進みます。

## プログラム全体の流れとmain.pyの対応箇所

このプログラムは、画像に写っている物体を自動で見つけてくれる「物体検出」のデモです。全体の流れと、main.pyのどこで何をしているかを以下にまとめます。

1. **必要なライブラリの読み込み**（main.py 1～4行目）
   - YOLO, OpenCV, NumPy, Matplotlib など、物体検出や画像処理に必要なライブラリをインポートします。
2. **YOLOモデルの準備**（main.py 9～11行目、45行目）
   - YOLOモデルを読み込む関数を定義し（9～11行目）、実際にモデルを読み込みます（45行目）。
3. **モデル情報の表示**（main.py 49行目）
   - 読み込んだYOLOモデルの情報（構造やパラメータ数など）を表示します。
4. **画像ファイルの指定**（main.py 54行目）
   - 検出したい画像ファイルのパスを指定します。
5. **物体検出の実行**（main.py 14～16行目、56行目）
   - 画像内の物体を検出する関数を定義し（14～16行目）、実際に検出を行います（56行目）。
6. **検出結果の表示**（main.py 57～58行目）
   - 検出結果を簡易的に表示し、検出された物体の数をターミナルに出力します。
7. **検出結果の描画・保存**（main.py 19～42行目、60行目）
   - 検出結果を画像に描画する関数を定義し（19～42行目）、実際に画像に描画・保存します（60行目）。

## `main.py`の詳細解説

以下は、`main.py` のコードを1行ずつ解説します。

| 行番号 | プログラム                                                                                               | 説明                                                                                                                               |
| ------ | -------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| 1      | `from ultralytics import YOLO`                                                                           | YOLOという物体検出ライブラリをインポートします。YOLOは「You Only Look Once」の略で、画像内の物体を高速に検出するためのツールです。 |
| 2      | `import cv2`                                                                                             | OpenCVという画像処理ライブラリをインポートします。画像の読み込みや加工に使います。                                                 |
| 3      | `import numpy as np`                                                                                     | NumPyという数値計算ライブラリをインポートします。画像データの操作に便利です。                                                      |
| 4      | `import matplotlib.pyplot as plt`                                                                        | Matplotlibというグラフ描画ライブラリをインポートします。画像を表示するために使います。                                             |
| 9-11   | `def load_yolo_model(model_path="yolo11n.pt"):`</br>`model = YOLO(model_path)`</br>`return model`        | YOLOモデルを読み込む関数を定義しています。`model_path`で指定されたファイルからモデルをロードします。                               |
| 14-16  | `def detect_objects_in_image(model, image_path):`</br>`results = model(image_path)`</br>`return results` | 指定された画像に対して物体検出を行う関数です。YOLOモデルを使って画像内の物体を検出し、その結果を返します。                         |
| 19-42  | `def visualize_results(image_path, results):`</br>`img = cv2.imread(image_path)`</br>`...`               | 検出結果を画像に描画し、ターミナルに出力する関数です。OpenCVを使って画像を読み込み、検出した物体の情報を描画します。               |
| 45     | `model = load_yolo_model()`                                                                              | YOLOモデルを読み込みます。このとき、デフォルトのモデルファイル`yolo11n.pt`が使われます。                                           |
| 49     | `model.info()`                                                                                           | モデルの情報を表示します。例えば、モデルの構造やパラメータ数などが出力されます。                                                   |
| 54     | `image_path = "./test_data/sandwich_1.jpg"`                                                              | 検出対象の画像ファイルのパスを指定します。この例では、`test_data`フォルダ内の`sandwich_1.jpg`を使用しています。                    |
| 56     | `results = detect_objects_in_image(model, image_path)`                                                   | 指定した画像に対して物体検出を実行し、結果を`results`に保存します。                                                                |
| 57     | `results[0].show()`                                                                                      | 検出結果を簡易的に表示します。YOLOライブラリの機能を使っています。                                                                 |
| 58     | `print(f"\nthe number of detection {len(results[0].boxes)}")`                                            | 検出された物体の数をターミナルに出力します。`len(results[0].boxes)`で検出された物体の数を取得します。                              |
| 60     | `visualize_results(image_path, results)`                                                                 | 検出結果を画像に描画し、保存します。また、ターミナルに詳細な情報を出力します。                                                     |

## `main.py` に定義されている関数の詳しい説明

### load_yolo_model(model_path="yolo11n.pt")

この関数はYOLOモデルを読み込むために使用されます。

- **引数**: `model_path` (文字列) - モデルのファイルパスを指定します。デフォルト値は`yolo11n.pt`です。

- **戻り値**: YOLOモデルオブジェクト。

- **詳細**: YOLOライブラリの`YOLO`クラスを使用して、指定されたパスからモデルをロードします。このモデルは物体検出に使用されます。

### detect_objects_in_image(model, image_path)

この関数は画像内の物体を検出します。

- **引数**:
  - `model` (YOLOモデルオブジェクト) - 物体検出に使用するモデル。
  - `image_path` (文字列) - 検出対象の画像ファイルのパス。

- **戻り値**: 検出結果オブジェクト。

- **詳細**: YOLOモデルを使用して、指定された画像内の物体を検出します。検出結果には、物体の位置やクラス情報が含まれます。

### visualize_results(image_path, results)

この関数は検出結果を画像に描画し、ターミナルに詳細情報を出力します。

- **引数**:
  - `image_path` (文字列) - 検出対象の画像ファイルのパス。
  - `results` (検出結果オブジェクト) - YOLOモデルによる検出結果。

- **戻り値**: なし。

- **詳細**:
  - OpenCVを使用して画像を読み込みます。
  - 検出された物体のバウンディングボックスやクラス名を画像に描画します。
  - 検出結果をターミナルに出力します（例: オブジェクト名、座標、信頼度）。
  - 処理後の画像を`output.jpg`として保存し、Matplotlibを使用して表示します。
