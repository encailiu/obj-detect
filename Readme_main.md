# main.py の解説資料

## プログラム全体の流れ

このプログラムは、画像に写っている物体を自動で見つけてくれる「物体検出」のデモです。主に次のような流れで動きます。

1. 必要なライブラリ（YOLO, OpenCV, NumPy, Matplotlib）を読み込みます。
2. YOLOというAIモデルを使って、物体検出用のモデルファイルを読み込みます。
3. 検出したい画像ファイルを指定します。
4. 画像の中にある物体をYOLOモデルで検出します。
5. 検出結果を画像に描き込み、ターミナルにも結果を表示します。
6. 最後に、検出結果を保存した画像（output.jpg）を作成します。

このように、プログラムは「モデルの準備」→「画像の指定」→「物体検出」→「結果の表示・保存」という順番で進みます。

## プログラム全体の流れとmain.pyの対応箇所

このプログラムは、画像に写っている物体を自動で見つけてくれる「物体検出」のデモです。全体の流れと、main.pyのどこで何をしているかを以下にまとめます。

1. **必要なライブラリの読み込み**（main.py 1～4行目）
   - YOLO, OpenCV, NumPy, Matplotlib など、物体検出や画像処理に必要なライブラリをインポートします。
2. **YOLOモデルの準備**（main.py 6～8行目、38行目）
   - YOLOモデルを読み込む関数を定義し（6～8行目）、実際にモデルを読み込みます（38行目）。
3. **モデル情報の表示**（main.py 40行目）
   - 読み込んだYOLOモデルの情報（構造やパラメータ数など）を表示します。
4. **画像ファイルの指定**（main.py 42行目）
   - 検出したい画像ファイルのパスを指定します。
5. **物体検出の実行**（main.py 10～12行目、44行目）
   - 画像内の物体を検出する関数を定義し（10～12行目）、実際に検出を行います（44行目）。
6. **検出結果の表示**（main.py 45～46行目）
   - 検出結果を簡易的に表示し、検出された物体の数をターミナルに出力します。
7. **検出結果の描画・保存**（main.py 14～36行目、48行目）
   - 検出結果を画像に描画する関数を定義し（14～36行目）、実際に画像に描画・保存します（48行目）。

このように、main.pyの各部分がプログラムの流れに対応しており、どこで何をしているかが分かりやすくなっています。

## `main.py`の詳細解説

以下は、`main.py` のコードを1行ずつ解説します。

| 行番号 | プログラム | 説明 |
|--------|------------|------|
| 1      | `from ultralytics import YOLO` | YOLOという物体検出ライブラリをインポートします。YOLOは「You Only Look Once」の略で、画像内の物体を高速に検出するためのツールです。 |
| 2      | `import cv2` | OpenCVという画像処理ライブラリをインポートします。画像の読み込みや加工に使います。 |
| 3      | `import numpy as np` | NumPyという数値計算ライブラリをインポートします。画像データの操作に便利です。 |
| 4      | `import matplotlib.pyplot as plt` | Matplotlibというグラフ描画ライブラリをインポートします。画像を表示するために使います。 |
| 6-8    | `def load_yolo_model(model_path="yolo11n.pt"):`<br>`model = YOLO(model_path)`<br>`return model` | YOLOモデルを読み込む関数を定義しています。`model_path`で指定されたファイルからモデルをロードします。 |
| 10-12  | `def detect_objects_in_image(model, image_path):`<br>`results = model(image_path)`<br>`return results` | 指定された画像に対して物体検出を行う関数です。YOLOモデルを使って画像内の物体を検出し、その結果を返します。 |
| 14-36  | `def visualize_results(image_path, results):`<br>`img = cv2.imread(image_path)`<br>`...` | 検出結果を画像に描画し、ターミナルに出力する関数です。OpenCVを使って画像を読み込み、検出した物体の情報を描画します。 |
| 38     | `model = load_yolo_model()` | YOLOモデルを読み込みます。このとき、デフォルトのモデルファイル`yolo11n.pt`が使われます。 |
| 40     | `model.info()` | モデルの情報を表示します。例えば、モデルの構造やパラメータ数などが出力されます。 |
| 42     | `image_path = "./test_data/sandwich_1.jpg"` | 検出対象の画像ファイルのパスを指定します。この例では、`test_data`フォルダ内の`sandwich_1.jpg`を使用しています。 |
| 44     | `results = detect_objects_in_image(model, image_path)` | 指定した画像に対して物体検出を実行し、結果を`results`に保存します。 |
| 45     | `results[0].show()` | 検出結果を簡易的に表示します。YOLOライブラリの機能を使っています。 |
| 46     | `print(f"\nthe number of detection {len(results[0].boxes)}")` | 検出された物体の数をターミナルに出力します。`len(results[0].boxes)`で検出された物体の数を取得します。 |
| 48     | `visualize_results(image_path, results)` | 検出結果を画像に描画し、保存します。また、ターミナルに詳細な情報を出力します。 |

## `main.py` に定義されている関数の詳しい説明

### load_yolo_model(model_path="yolo11n.pt")

この関数はYOLOモデルを読み込むために使用されます。

- **引数**: `model_path` (文字列) - モデルのファイルパスを指定します。デフォルト値は`yolo11n.pt`です。

- **戻り値**: YOLOモデルオブジェクト。

- **詳細**: YOLOライブラリの`YOLO`クラスを使用して、指定されたパスからモデルをロードします。このモデルは物体検出に使用されます。

### detect_objects_in_image(model, image_path)

この関数は画像内の物体を検出します。

- **引数**:
  - `model` (YOLOモデルオブジェクト) - 物体検出に使用するモデル。
  - `image_path` (文字列) - 検出対象の画像ファイルのパス。

- **戻り値**: 検出結果オブジェクト。

- **詳細**: YOLOモデルを使用して、指定された画像内の物体を検出します。検出結果には、物体の位置やクラス情報が含まれます。

### visualize_results(image_path, results)

この関数は検出結果を画像に描画し、ターミナルに詳細情報を出力します。

- **引数**:
  - `image_path` (文字列) - 検出対象の画像ファイルのパス。
  - `results` (検出結果オブジェクト) - YOLOモデルによる検出結果。

- **戻り値**: なし。

- **詳細**:
  - OpenCVを使用して画像を読み込みます。
  - 検出された物体のバウンディングボックスやクラス名を画像に描画します。
  - 検出結果をターミナルに出力します（例: オブジェクト名、座標、信頼度）。
  - 処理後の画像を`output.jpg`として保存し、Matplotlibを使用して表示します。
